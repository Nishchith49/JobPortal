import{F as r,I as o,Lb as a,g as s}from"./chunk-HTWSWMIO.js";var l={ROLES:{SUPER_ADMIN:"SuperAdmin"},authData:{access_token:"access",refresh_token:"refresh",expiresIn:"expiresIn",tokenType:"tokenType"}};var c=class i{constructor(e){this._router=e}defaultProfile;_userDetailsListener=new s(!1);userDetailsListener$=this._userDetailsListener.asObservable();_userLocationListener=new s(null);userLocationListener$=this._userLocationListener.asObservable();_loginListener=new s(!1);loginListener$=this._loginListener.asObservable();today=new Date;tokenExpirationTimer;accessToken;superAdminLogin=!1;configuration;get isSuperAdminLogin(){return this.superAdminLogin}getToken(){return localStorage.getItem("token")}get storage(){return localStorage}autoLogout(e){this.tokenExpirationTimer=setTimeout(()=>{this.logout(),alert("Session Timed Out! Please Login")},e)}handleUserAuthentication(){if(localStorage.getItem("userData")){let e=JSON.parse(localStorage.getItem("userData")??"");try{if(e.expiresIn&&e.accessToken)if(this.accessToken=e.accessToken,this.accessToken){let t=this.parseJwt(this.accessToken);this.superAdminLogin=t.role===l.ROLES.SUPER_ADMIN;let n={accessToken:e.accessToken,expiresIn:e.expiresIn,refreshToken:e.refreshToken,tokenType:e.tokenType,name:e.name};this._userDetailsListener.next(n),this._loginListener.next(this.isSuperAdminLogin)}else this._loginListener.next(!1);else this._loginListener.next(!1),this._userDetailsListener.next(this.defaultProfile)}catch{this._loginListener.next(!1),this._userDetailsListener.next(this.defaultProfile)}}}parseJwt(e){let t=e.split(".")[1],n=decodeURIComponent(window.atob(t).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(n)}logout(){localStorage.removeItem("userData"),this.superAdminLogin=!1,this._loginListener.next(!1),this.handleUserAuthentication(),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer),this.tokenExpirationTimer=null,this._router.navigateByUrl("")}static \u0275fac=function(t){return new(t||i)(o(a))};static \u0275prov=r({token:i,factory:i.\u0275fac,providedIn:"root"})};export{c as a};

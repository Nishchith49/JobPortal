import{a as tt}from"./chunk-H6RMZ57J.js";import{c as Ye,d as $,e as Qe,f as Ge,g as $e,h as ue,i as Ke,j as Je,k as Ze,o as K,p as it,q as nt}from"./chunk-Y6IDWSZT.js";import{a as et}from"./chunk-JDQVLM36.js";import{b as ot}from"./chunk-E3ZN6SRN.js";import"./chunk-HJA2ZWVN.js";import{a as J}from"./chunk-BD465OXD.js";import{$ as Ve,Aa as ke,Ab as Ue,B as le,Ba as He,Da as E,F as Se,Fa as d,Fb as We,Ga as l,Gb as Le,Hb as Be,I as Oe,Ib as De,Ja as he,Jb as je,K as Pe,Ka as ge,Kb as qe,La as de,Lb as Ne,M as m,Ma as Fe,N as h,Na as U,Oa as Y,Ob as Xe,Q as Te,R as L,Ra as _,S as Ae,Ta as Q,_ as X,a as M,b as A,ba as u,db as Ee,f as ze,fa as S,gb as P,ia as O,na as y,pb as W,q as V,r as pe,ta as me,wa as f,x as Re,xa as p,ya as c,yb as G,za as x}from"./chunk-HTWSWMIO.js";function _t(r,e){r&1&&(p(0,"span"),_(1,"Email is required."),c())}function Ct(r,e){r&1&&(p(0,"span"),_(1,"Please enter a valid email address."),c())}function Mt(r,e){if(r&1&&(p(0,"div",13),y(1,_t,2,0,"span",14)(2,Ct,2,0,"span",14),c()),r&2){let i=l();u(),f("ngIf",i.signInForm.controls.emailId.errors==null?null:i.signInForm.controls.emailId.errors.required),u(),f("ngIf",i.signInForm.controls.emailId.errors==null?null:i.signInForm.controls.emailId.errors.email)}}function wt(r,e){r&1&&(p(0,"span"),_(1,"Password is required."),c())}function bt(r,e){if(r&1&&(p(0,"div",13),y(1,wt,2,0,"span",14),c()),r&2){let i=l();u(),f("ngIf",i.signInForm.controls.password.errors==null?null:i.signInForm.controls.password.errors.required)}}function yt(r,e){r&1&&x(0,"span",15)}var Z=class r{constructor(e,i,t,n,o){this._route=e;this._authenticationService=i;this._router=t;this._accountsService=n;this._snackBar=o}signInForm=new $e({emailId:new ue(null,[$.required,$.email]),password:new ue(null,[$.required])});isLoading=!1;userDate;returnUrl;ngOnInit(){let e=this._route.snapshot.queryParams.returnUrl;e&&(this.returnUrl=window.atob(e)),this._authenticationService._loginListener.subscribe(i=>{i&&this._authenticationService.isSuperAdminLogin&&this._router.navigateByUrl(this.returnUrl||"/admin/dashboard")}),this._authenticationService.handleUserAuthentication()}onSubmit(){if(this.signInForm.invalid){this.signInForm.markAllAsTouched();return}this.isLoading=!0,this.signInForm.disable();let e={email:this.signInForm.controls.emailId.value?.trim(),password:this.signInForm.controls.password.value?.trim()};this._accountsService.apiAccountsLoginPost(e).subscribe({next:i=>{this.isLoading=!1,this.signInForm.enable(),i.statusCode===200?(i.data?.accessToken&&localStorage.setItem("token",i.data.accessToken),localStorage.removeItem("userData"),this._snackBar.open(i.message??"Logged in successfully","Close",{duration:3e3,panelClass:["snack-success"]}),this._router.navigate(["/admin/dashboard"])):this._snackBar.open(i.message??"Login failed","Close",{duration:3e3,panelClass:["snack-error"]})},error:i=>{this.isLoading=!1,this.signInForm.enable();let t=navigator.onLine?"Something went wrong. Please try again later.":"Internet Connection Lost. Please check your connectivity.";this._snackBar.open(t,"Close",{duration:4e3,panelClass:["snack-error"]})}})}static \u0275fac=function(i){return new(i||r)(S(je),S(J),S(Ne),S(et),S(tt))};static \u0275cmp=O({type:r,selectors:[["app-sign-in"]],decls:25,vars:6,consts:[[1,"container"],[1,"left-section"],[1,"overlay"],[1,"right-section"],[1,"form-container"],[3,"ngSubmit","formGroup"],["for","email"],["type","email","id","email","formControlName","emailId","placeholder","xyz@gmail.com"],["class","error",4,"ngIf"],["for","password"],["type","password","id","password","formControlName","password","placeholder","Enter your password"],["type","submit","id","submitBtn",3,"disabled"],["class","spinner",4,"ngIf"],[1,"error"],[4,"ngIf"],[1,"spinner"]],template:function(i,t){i&1&&(p(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),_(4,"WELCOME TO"),c(),p(5,"h1"),_(6,"SCREW SOFT SOLUTIONS"),c(),p(7,"h2"),_(8,"CRM PORTAL"),c()()(),p(9,"div",3)(10,"div",4)(11,"h3"),_(12,"Login"),c(),p(13,"form",5),d("ngSubmit",function(){return t.onSubmit()}),p(14,"label",6),_(15,"Email Id"),c(),x(16,"input",7),y(17,Mt,3,2,"div",8),p(18,"label",9),_(19,"Password"),c(),x(20,"input",10),y(21,bt,2,1,"div",8),p(22,"button",11),_(23),y(24,yt,1,0,"span",12),c()()()()()),i&2&&(u(13),f("formGroup",t.signInForm),u(4),f("ngIf",t.signInForm.controls.emailId.touched&&t.signInForm.controls.emailId.invalid),u(4),f("ngIf",t.signInForm.controls.password.touched&&t.signInForm.controls.password.invalid),u(),f("disabled",t.isLoading),u(),Q(" ",t.isLoading?"Please wait...":"Proceed To Login"," "),u(),f("ngIf",t.isLoading))},dependencies:[G,W,K,Ke,Ye,Qe,Ge,Je,Ze],styles:['*[_ngcontent-%COMP%]{box-sizing:border-box}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%;margin:0;padding:0;font-family:Roboto,sans-serif;background-color:#f5f5f5}.container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;height:100vh;width:100vw;overflow:hidden}.left-section[_ngcontent-%COMP%]{flex:1 1 60%;background:url("./media/login-bg-JM44TAV5.jpg") no-repeat center center;background-color:#000;background-size:cover;color:#fff;display:flex;align-items:center;justify-content:center;padding:40px}.overlay[_ngcontent-%COMP%]{padding:30px;text-align:center;border-radius:10px}.right-section[_ngcontent-%COMP%]{flex:1 1 40%;display:flex;align-items:center;justify-content:center;padding:40px;background-color:#fff;overflow-y:auto;max-height:100vh}.form-container[_ngcontent-%COMP%]{width:100%;max-width:400px}.form-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60px;display:block;margin:0 auto 20px}h3[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin:10px 0;text-align:center}input[_ngcontent-%COMP%]{width:100%;padding:10px;margin-top:5px;margin-bottom:10px;border:1px solid #ccc;border-radius:4px}.error[_ngcontent-%COMP%]{color:red;font-size:12px;margin-bottom:10px}button[_ngcontent-%COMP%]{width:100%;padding:12px;background-color:#3f51b5;color:#fff;border:none;border-radius:4px;font-size:16px;cursor:pointer}button[_ngcontent-%COMP%]:disabled{background-color:gray;cursor:not-allowed}@media (max-width: 768px){.left-section[_ngcontent-%COMP%]{display:none}.right-section[_ngcontent-%COMP%]{flex:1 1 100%}}.spinner[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid white;border-top:2px solid transparent;border-radius:50%;animation:_ngcontent-%COMP%_spin .6s linear infinite;margin-left:10px;vertical-align:middle}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']})};var vt=["wrapper"],It=["sourceImage"];function zt(r,e){if(r&1){let i=E();p(0,"img",5,0),d("load",function(){m(i);let n=l();return h(n.imageLoadedInView())})("mousedown",function(n){m(i);let o=l();return h(o.startMove(n,o.moveTypes.Drag))})("touchstart",function(n){m(i);let o=l();return h(o.startMove(n,o.moveTypes.Drag))})("error",function(n){m(i);let o=l();return h(o.loadImageError(n))}),c()}if(r&2){let i=e.ngIf,t=l();U("visibility",t.imageVisible?"visible":"hidden")("transform",t.safeTransformStyle()),Y("ngx-ic-draggable",!t.disabled&&t.allowMoveImage),f("src",i,X),me("alt",t.imageAltText)}}function Rt(r,e){if(r&1){let i=E();ke(0),p(1,"span",9),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"topleft"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"topleft"))}),x(2,"span",10),c(),p(3,"span",11),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"topright"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"topright"))}),x(4,"span",10),c(),p(5,"span",12),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"bottomright"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"bottomright"))}),x(6,"span",10),c(),p(7,"span",13),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"bottomleft"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"bottomleft"))}),x(8,"span",10),c(),p(9,"span",14),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"top"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"top"))}),c(),p(10,"span",15),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"top"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"top"))}),x(11,"span",10),c(),p(12,"span",16),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"right"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"right"))}),c(),p(13,"span",17),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"right"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"right"))}),x(14,"span",10),c(),p(15,"span",18),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"bottom"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"bottom"))}),c(),p(16,"span",19),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"bottom"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"bottom"))}),x(17,"span",10),c(),p(18,"span",20),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"left"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"left"))}),c(),p(19,"span",21),d("mousedown",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"left"))})("touchstart",function(n){m(i);let o=l(2);return h(o.startMove(n,o.moveTypes.Resize,"left"))}),x(20,"span",10),c(),He()}}function St(r,e){if(r&1){let i=E();p(0,"div",6),d("keydown",function(n){m(i);let o=l();return h(o.keyboardAccess(n))}),p(1,"div",7),d("mousedown",function(n){m(i);let o=l();return h(o.startMove(n,o.moveTypes.Move))})("touchstart",function(n){m(i);let o=l();return h(o.startMove(n,o.moveTypes.Move))}),c(),y(2,Rt,21,0,"ng-container",8),c()}if(r&2){let i=l();U("top",i.state.cropper().y1,"px")("left",i.state.cropper().x1,"px")("width",i.state.cropper().x2-i.state.cropper().x1,"px")("height",i.state.cropper().y2-i.state.cropper().y1,"px")("margin-left",i.state.options.alignImage==="center"?i.marginLeft:null)("visibility",i.imageVisible?"visible":"hidden"),Y("ngx-ic-round",i.state.options.roundCropper),me("aria-label",i.state.options.cropperFrameAriaLabel),u(2),f("ngIf",!i.state.options.hideResizeSquares&&!(i.state.options.cropperStaticWidth&&i.state.options.cropperStaticHeight))}}function B(r,e,i){return r=Ot(r,e),te(r,e,i)}function Ot(r,e){let i=r.x2-r.x1,t=r.y2-r.y1,n=r.x1+i/2,o=r.y1+t/2;e.options.cropperStaticHeight&&e.options.cropperStaticWidth?(i=e.maxSize().width>e.options.cropperStaticWidth?e.options.cropperStaticWidth:e.maxSize().width,t=e.maxSize().height>e.options.cropperStaticHeight?e.options.cropperStaticHeight:e.maxSize().height):(i=Math.max(e.cropperScaledMinWidth,Math.min(i,e.cropperScaledMaxWidth,e.maxSize().width)),t=Math.max(e.cropperScaledMinHeight,Math.min(t,e.cropperScaledMaxHeight,e.maxSize().height)),e.options.maintainAspectRatio&&(e.maxSize().width/e.options.aspectRatio<e.maxSize().height?t=i/e.options.aspectRatio:i=t*e.options.aspectRatio));let a=n-i/2,s=a+i,g=o-t/2,C=g+t;return{x1:a,x2:s,y1:g,y2:C}}function te(r,e,i=!1){return r.x1<0&&(r=A(M({},r),{x1:0,x2:r.x2-(i?r.x1:0)})),r.y1<0&&(r=A(M({},r),{y2:r.y2-(i?r.y1:0),y1:0})),r.x2>e.maxSize().width&&(r=A(M({},r),{x1:r.x1-(i?r.x2-e.maxSize().width:0),x2:e.maxSize().width})),r.y2>e.maxSize().height&&(r=A(M({},r),{y1:r.y1-(i?r.y2-e.maxSize().height:0),y2:e.maxSize().height})),r}function Pt(r,e){let i=ie(r)-e.clientX,t=ne(r)-e.clientY;return{x1:e.cropper.x1+i,y1:e.cropper.y1+t,x2:e.cropper.x2+i,y2:e.cropper.y2+t}}function at(r,e,i){let t=M({},i.cropper()),n=ie(r)-e.clientX,o=ne(r)-e.clientY;switch(e.position){case"left":t.x1=Math.min(Math.max(e.cropper.x1+n,t.x2-i.cropperScaledMaxWidth),t.x2-i.cropperScaledMinWidth);break;case"topleft":t.x1=Math.min(Math.max(e.cropper.x1+n,t.x2-i.cropperScaledMaxWidth),t.x2-i.cropperScaledMinWidth),t.y1=Math.min(Math.max(e.cropper.y1+o,t.y2-i.cropperScaledMaxHeight),t.y2-i.cropperScaledMinHeight);break;case"top":t.y1=Math.min(Math.max(e.cropper.y1+o,t.y2-i.cropperScaledMaxHeight),t.y2-i.cropperScaledMinHeight);break;case"topright":t.x2=Math.max(Math.min(e.cropper.x2+n,t.x1+i.cropperScaledMaxWidth),t.x1+i.cropperScaledMinWidth),t.y1=Math.min(Math.max(e.cropper.y1+o,t.y2-i.cropperScaledMaxHeight),t.y2-i.cropperScaledMinHeight);break;case"right":t.x2=Math.max(Math.min(e.cropper.x2+n,t.x1+i.cropperScaledMaxWidth),t.x1+i.cropperScaledMinWidth);break;case"bottomright":t.x2=Math.max(Math.min(e.cropper.x2+n,t.x1+i.cropperScaledMaxWidth),t.x1+i.cropperScaledMinWidth),t.y2=Math.max(Math.min(e.cropper.y2+o,t.y1+i.cropperScaledMaxHeight),t.y1+i.cropperScaledMinHeight);break;case"bottom":t.y2=Math.max(Math.min(e.cropper.y2+o,t.y1+i.cropperScaledMaxHeight),t.y1+i.cropperScaledMinHeight);break;case"bottomleft":t.x1=Math.min(Math.max(e.cropper.x1+n,t.x2-i.cropperScaledMaxWidth),t.x2-i.cropperScaledMinWidth),t.y2=Math.max(Math.min(e.cropper.y2+o,t.y1+i.cropperScaledMaxHeight),t.y1+i.cropperScaledMinHeight);break;case"center":let a="scale"in r?r.scale:1,s=Math.min(Math.max(i.cropperScaledMinWidth,Math.abs(e.cropper.x2-e.cropper.x1)*a),i.cropperScaledMaxWidth),g=Math.min(Math.max(i.cropperScaledMinHeight,Math.abs(e.cropper.y2-e.cropper.y1)*a),i.cropperScaledMaxHeight);t.x1=e.clientX-s/2,t.x2=e.clientX+s/2,t.y1=e.clientY-g/2,t.y2=e.clientY+g/2,t.x1<0?(t.x2-=t.x1,t.x1=0):t.x2>i.maxSize().width&&(t.x1-=t.x2-i.maxSize().width,t.x2=i.maxSize().width),t.y1<0?(t.y2-=t.y1,t.y1=0):t.y2>i.maxSize().height&&(t.y1-=t.y2-i.maxSize().height,t.y2=i.maxSize().height);break}return i.options.maintainAspectRatio?Tt(e.position,t,i):t}function Tt(r,e,i){e=M({},e);let t=0,n=0;switch(r){case"top":e.x2=e.x1+(e.y2-e.y1)*i.options.aspectRatio,t=Math.max(e.x2-i.maxSize().width,0),n=Math.max(0-e.y1,0),(t>0||n>0)&&(e.x2-=n*i.options.aspectRatio>t?n*i.options.aspectRatio:t,e.y1+=n*i.options.aspectRatio>t?n:t/i.options.aspectRatio);break;case"bottom":e.x2=e.x1+(e.y2-e.y1)*i.options.aspectRatio,t=Math.max(e.x2-i.maxSize().width,0),n=Math.max(e.y2-i.maxSize().height,0),(t>0||n>0)&&(e.x2-=n*i.options.aspectRatio>t?n*i.options.aspectRatio:t,e.y2-=n*i.options.aspectRatio>t?n:t/i.options.aspectRatio);break;case"topleft":e.y1=e.y2-(e.x2-e.x1)/i.options.aspectRatio,t=Math.max(0-e.x1,0),n=Math.max(0-e.y1,0),(t>0||n>0)&&(e.x1+=n*i.options.aspectRatio>t?n*i.options.aspectRatio:t,e.y1+=n*i.options.aspectRatio>t?n:t/i.options.aspectRatio);break;case"topright":e.y1=e.y2-(e.x2-e.x1)/i.options.aspectRatio,t=Math.max(e.x2-i.maxSize().width,0),n=Math.max(0-e.y1,0),(t>0||n>0)&&(e.x2-=n*i.options.aspectRatio>t?n*i.options.aspectRatio:t,e.y1+=n*i.options.aspectRatio>t?n:t/i.options.aspectRatio);break;case"right":case"bottomright":e.y2=e.y1+(e.x2-e.x1)/i.options.aspectRatio,t=Math.max(e.x2-i.maxSize().width,0),n=Math.max(e.y2-i.maxSize().height,0),(t>0||n>0)&&(e.x2-=n*i.options.aspectRatio>t?n*i.options.aspectRatio:t,e.y2-=n*i.options.aspectRatio>t?n:t/i.options.aspectRatio);break;case"left":case"bottomleft":e.y2=e.y1+(e.x2-e.x1)/i.options.aspectRatio,t=Math.max(0-e.x1,0),n=Math.max(e.y2-i.maxSize().height,0),(t>0||n>0)&&(e.x1+=n*i.options.aspectRatio>t?n*i.options.aspectRatio:t,e.y2-=n*i.options.aspectRatio>t?n:t/i.options.aspectRatio);break;case"center":e.x2=e.x1+(e.y2-e.y1)*i.options.aspectRatio,e.y2=e.y1+(e.x2-e.x1)/i.options.aspectRatio;let o=Math.max(0-e.x1,0),a=Math.max(e.x2-i.maxSize().width,0),s=Math.max(e.y2-i.maxSize().height,0),g=Math.max(0-e.y1,0);(o>0||a>0||s>0||g>0)&&(e.x1+=s*i.options.aspectRatio>o?s*i.options.aspectRatio:o,e.x2-=g*i.options.aspectRatio>a?g*i.options.aspectRatio:a,e.y1+=g*i.options.aspectRatio>a?g:a/i.options.aspectRatio,e.y2-=s*i.options.aspectRatio>o?s:o/i.options.aspectRatio);break}return e}function ie(r){return"touches"in r&&r.touches[0]?r.touches[0].clientX:"clientX"in r?r.clientX:0}function ne(r){return"touches"in r&&r.touches[0]?r.touches[0].clientY:"clientX"in r?r.clientY:0}var fe=class{constructor(){this.cropper=L({x1:0,x2:0,y1:0,y2:0}),this.maxSize=L({width:0,height:0}),this.transform={},this.options={format:"png",output:"blob",autoCrop:!0,maintainAspectRatio:!0,aspectRatio:1,resetCropOnAspectRatioChange:!0,resizeToWidth:0,resizeToHeight:0,cropperMinWidth:0,cropperMinHeight:0,cropperMaxHeight:0,cropperMaxWidth:0,cropperStaticWidth:0,cropperStaticHeight:0,canvasRotation:0,roundCropper:!1,onlyScaleDown:!1,imageQuality:92,backgroundColor:void 0,containWithinAspectRatio:!1,hideResizeSquares:!1,alignImage:"center",cropperFrameAriaLabel:void 0,checkImageType:!0},this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=3}setOptionsFromChanges(e){e.options?.currentValue&&this.setOptions(e.options.currentValue);let i=Object.entries(e).filter(([t])=>t in this.options).reduce((t,[n,o])=>A(M({},t),{[n]:o.currentValue}),{});Object.keys(i).length>0&&this.setOptions(i)}setOptions(e){if(this.options=M(M({},this.options),e||{}),this.validateOptions(),!this.loadedImage?.transformed.image.complete||!this.maxSize)return;let i=!1;this.options.maintainAspectRatio&&e.aspectRatio||"maintainAspectRatio"in e?(this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.options.maintainAspectRatio&&(this.options.resetCropOnAspectRatioChange||!this.aspectRatioIsCorrect())&&(this.cropper.set(this.maxSizeCropperPosition()),i=!0)):((e.cropperMinWidth||e.cropperMinHeight)&&(this.setCropperScaledMinSize(),i=!0),(e.cropperMaxWidth||e.cropperMaxHeight)&&(this.setCropperScaledMaxSize(),i=!0),(e.cropperStaticWidth||e.cropperStaticHeight)&&(i=!0)),i&&this.cropper.update(t=>B(t,this,!1))}validateOptions(){if(this.options.maintainAspectRatio&&!this.options.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}setMaxSize(e,i){this.maxSize.set({width:e,height:i}),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()}setCropperScaledMinSize(){this.loadedImage?.transformed.size?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.cropperScaledMinWidth=this.options.cropperMinWidth>0?Math.max(20,this.options.cropperMinWidth/this.loadedImage.transformed.size.width*this.maxSize().width):20}setCropperScaledMinHeight(){this.options.maintainAspectRatio?this.cropperScaledMinHeight=Math.max(20,this.cropperScaledMinWidth/this.options.aspectRatio):this.options.cropperMinHeight>0?this.cropperScaledMinHeight=Math.max(20,this.options.cropperMinHeight/this.loadedImage.transformed.size.height*this.maxSize().height):this.cropperScaledMinHeight=20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed.size){let e=this.loadedImage.transformed.size.width/this.maxSize().width;this.cropperScaledMaxWidth=this.options.cropperMaxWidth>20?this.options.cropperMaxWidth/e:this.maxSize().width,this.cropperScaledMaxHeight=this.options.cropperMaxHeight>20?this.options.cropperMaxHeight/e:this.maxSize().height,this.options.maintainAspectRatio&&(this.cropperScaledMaxWidth>this.cropperScaledMaxHeight*this.options.aspectRatio?this.cropperScaledMaxWidth=this.cropperScaledMaxHeight*this.options.aspectRatio:this.cropperScaledMaxWidth<this.cropperScaledMaxHeight*this.options.aspectRatio&&(this.cropperScaledMaxHeight=this.cropperScaledMaxWidth/this.options.aspectRatio))}else this.cropperScaledMaxWidth=this.maxSize().width,this.cropperScaledMaxHeight=this.maxSize().height}equalsCropperPosition(e){let i=this.cropper();return i==null&&e==null||i!=null&&e!=null&&i.x1.toFixed(3)===e.x1.toFixed(3)&&i.y1.toFixed(3)===e.y1.toFixed(3)&&i.x2.toFixed(3)===e.x2.toFixed(3)&&i.y2.toFixed(3)===e.y2.toFixed(3)}equalsTransformTranslate(e){return(this.transform.translateH??0)===(e.translateH??0)&&(this.transform.translateV??0)===(e.translateV??0)}equalsTransform(e){return this.equalsTransformTranslate(e)&&(this.transform.scale??1)===(e.scale??1)&&(this.transform.rotate??0)===(e.rotate??0)&&(this.transform.flipH??!1)===(e.flipH??!1)&&(this.transform.flipV??!1)===(e.flipV??!1)}aspectRatioIsCorrect(){let e=this.cropper();return(e.x2-e.x1)/(e.y2-e.y1)===this.options.aspectRatio}resizeCropperPosition(e){(e.width!==this.maxSize().width||e.height!==this.maxSize().height)&&this.cropper.update(i=>({x1:i.x1*this.maxSize().width/e.width,x2:i.x2*this.maxSize().width/e.width,y1:i.y1*this.maxSize().height/e.height,y2:i.y2*this.maxSize().height/e.height}))}maxSizeCropperPosition(){return{x1:0,y1:0,x2:this.maxSize().width,y2:this.maxSize().height}}toCropInput(){return{cropper:this.cropper(),maxSize:this.maxSize(),transform:this.transform,loadedImage:this.loadedImage,options:M({},this.options)}}},v=function(r){return r.Drag="drag",r.Move="move",r.Resize="resize",r.Pinch="pinch",r}(v||{});function At(r,e,i){let t=r.width,n=r.height;e=Math.round(e),i=Math.round(i);let o=t/e,a=n/i,s=Math.ceil(o/2),g=Math.ceil(a/2),C=r.getContext("2d");if(C){let T=C.getImageData(0,0,t,n),I=C.createImageData(e,i),w=T.data,b=I.data;for(let z=0;z<i;z++)for(let k=0;k<e;k++){let D=(k+z*e)*4,mt=z*a,R=0,j=0,Ce=0,Me=0,we=0,be=0,ye=0,ht=Math.floor(k*o),gt=Math.floor(z*a),se=Math.ceil((k+1)*o),ce=Math.ceil((z+1)*a);se=Math.min(se,t),ce=Math.min(ce,n);for(let q=gt;q<ce;q++){let ve=Math.abs(mt-q)/g,dt=k*o,ut=ve*ve;for(let N=ht;N<se;N++){let Ie=Math.abs(dt-N)/s,H=Math.sqrt(ut+Ie*Ie);if(H>=1)continue;R=2*H*H*H-3*H*H+1;let F=4*(N+q*t);ye+=R*w[F+3],Ce+=R,w[F+3]<255&&(R=R*w[F+3]/250),Me+=R*w[F],we+=R*w[F+1],be+=R*w[F+2],j+=R}}b[D]=Me/j,b[D+1]=we/j,b[D+2]=be/j,b[D+3]=ye/Ce}r.width=e,r.height=i,C.putImageData(I,0,0)}}function st(r,e){return r/100*e}var xe=class{crop(e,i){let t=this.getImagePosition(e),n=t.x2-t.x1,o=t.y2-t.y1,a=document.createElement("canvas");a.width=n,a.height=o;let s=a.getContext("2d");if(!s)return null;e.options?.backgroundColor!=null&&(s.fillStyle=e.options.backgroundColor,s.fillRect(0,0,n,o));let g=(e.transform?.scale||1)*(e.transform?.flipH?-1:1),C=(e.transform?.scale||1)*(e.transform?.flipV?-1:1),{translateH:T,translateV:I}=this.getCanvasTranslate(e),w=e.loadedImage.transformed;s.setTransform(g,0,0,C,w.size.width/2+T,w.size.height/2+I),s.translate(-t.x1/g,-t.y1/C),s.rotate((e.transform?.rotate||0)*Math.PI/180),s.drawImage(w.image,-w.size.width/2,-w.size.height/2);let b={width:n,height:o,imagePosition:t,cropperPosition:M({},e.cropper)};e.options?.containWithinAspectRatio&&(b.offsetImagePosition=this.getOffsetImagePosition(e));let z=this.getResizeRatio(n,o,e.options);return z!==1&&(b.width=Math.round(n*z),b.height=e.options?.maintainAspectRatio?Math.round(b.width/(e.options?.aspectRatio??1)):Math.round(o*z),At(a,b.width,b.height)),i==="blob"?this.cropToBlob(b,a,e):(b.base64=a.toDataURL("image/"+(e.options?.format??"png"),this.getQuality(e.options)),b)}async cropToBlob(e,i,t){return e.blob=await new Promise(n=>i.toBlob(n,"image/"+(t.options?.format??"png"),this.getQuality(t.options))),e.blob&&(e.objectUrl=URL.createObjectURL(e.blob)),e}getCanvasTranslate(e){if(e.transform?.translateUnit==="px"){let i=this.getRatio(e);return{translateH:(e.transform?.translateH||0)*i,translateV:(e.transform?.translateV||0)*i}}else return{translateH:e.transform?.translateH?st(e.transform.translateH,e.loadedImage.transformed.size.width):0,translateV:e.transform?.translateV?st(e.transform.translateV,e.loadedImage.transformed.size.height):0}}getRatio(e){return e.loadedImage.transformed.size.width/e.maxSize.width}getImagePosition(e){let i=this.getRatio(e),t={x1:Math.round(e.cropper.x1*i),y1:Math.round(e.cropper.y1*i),x2:Math.round(e.cropper.x2*i),y2:Math.round(e.cropper.y2*i)};return e.options?.containWithinAspectRatio||(t.x1=Math.max(t.x1,0),t.y1=Math.max(t.y1,0),t.x2=Math.min(t.x2,e.loadedImage.transformed.size.width),t.y2=Math.min(t.y2,e.loadedImage.transformed.size.height)),t}getOffsetImagePosition(e){let i=(e.options?.canvasRotation??0)+e.loadedImage.exifTransform.rotate,t=this.getRatio(e),n,o;i%2?(n=(e.loadedImage.transformed.size.width-e.loadedImage.original.size.height)/2,o=(e.loadedImage.transformed.size.height-e.loadedImage.original.size.width)/2):(n=(e.loadedImage.transformed.size.width-e.loadedImage.original.size.width)/2,o=(e.loadedImage.transformed.size.height-e.loadedImage.original.size.height)/2);let a=e.cropper,s={x1:Math.round(a.x1*t)-n,y1:Math.round(a.y1*t)-o,x2:Math.round(a.x2*t)-n,y2:Math.round(a.y2*t)-o};return e.options?.containWithinAspectRatio||(s.x1=Math.max(s.x1,0),s.y1=Math.max(s.y1,0),s.x2=Math.min(s.x2,e.loadedImage.transformed.size.width),s.y2=Math.min(s.y2,e.loadedImage.transformed.size.height)),s}getResizeRatio(e,i,t){let n=new Array;t?.resizeToWidth&&t.resizeToWidth>0&&n.push(t.resizeToWidth/e),t?.resizeToHeight&&t.resizeToHeight>0&&n.push(t.resizeToHeight/i);let o=n.length===0?1:Math.min(...n);return o>1&&!t?.onlyScaleDown?o:Math.min(o,1)}getQuality(e){return Math.min(1,Math.max(0,(e?.imageQuality??92)/100))}},Vt=[new Uint8Array([255,216,255,225,0,34,69,120,105,102,0,0,77,77,0,42,0,0,0,8,0,1,1,18,0,3,0,0,0,1,0,6,0,0,0,0,0,0,255,219,0,132,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,255,192,0,17,8,0,1,0,2,3,1,17,0,2,17,1,3,17,1,255,196,0,74,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,16,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,218,0,12,3,1,0,2,17,3,17,0,63,0,63,240,127,255,217])],kt=URL.createObjectURL(new Blob(Vt,{type:"image/jpeg"}));function Ht(){return new Promise(r=>{let e=new Image;e.onload=()=>{let i=e.width===1&&e.height===2;r(i)},e.src=kt})}function Ft(r){switch(typeof r=="object"&&(r=Et(r)),r){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}function Et(r){let e=new DataView(r);if(e.getUint16(0,!1)!==65496)return-2;let i=e.byteLength,t=2;for(;t<i;){if(e.getUint16(t+2,!1)<=8)return-1;let n=e.getUint16(t,!1);if(t+=2,n==65505){if(e.getUint32(t+=2,!1)!==1165519206)return-1;let o=e.getUint16(t+=6,!1)==18761;t+=e.getUint32(t+4,o);let a=e.getUint16(t,o);t+=2;for(let s=0;s<a;s++)if(e.getUint16(t+s*12,o)==274)return e.getUint16(t+s*12+8,o)}else{if((n&65280)!==65280)break;t+=e.getUint16(t,!1)}}return-1}var _e=class{constructor(){this.autoRotateSupported=Ht()}async loadImageFile(e,i){let t=await e.arrayBuffer();return i.checkImageType?await this.checkImageTypeAndLoadImageFromArrayBuffer(t,e.type,i):await this.loadImageFromArrayBuffer(t,i)}checkImageTypeAndLoadImageFromArrayBuffer(e,i,t){return this.isValidImageType(i)?this.loadImageFromArrayBuffer(e,t,i):Promise.reject(new Error("Invalid image type"))}isValidImageType(e){return/image\/(png|jpg|jpeg|heic|bmp|gif|tiff|svg|webp|x-icon|vnd.microsoft.icon)/.test(e)}async loadImageFromURL(e,i){let n=await(await fetch(e)).blob(),o=await n.arrayBuffer();return await this.loadImageFromArrayBuffer(o,i,n.type)}loadBase64Image(e,i){let t=this.base64ToArrayBuffer(e);return this.loadImageFromArrayBuffer(t,i)}base64ToArrayBuffer(e){e=e.replace(/^data:([^;]+);base64,/gmi,"");let i=atob(e),t=i.length,n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=i.charCodeAt(o);return n.buffer}async loadImageFromArrayBuffer(e,i,t){let n=await new Promise(async(o,a)=>{try{let s=new Blob([e],t?{type:t}:void 0),g=URL.createObjectURL(s),C=new Image,I=t==="image/svg+xml"?await this.getSvgImageSize(s):void 0;C.onload=()=>o({originalImage:C,originalImageSize:I,originalObjectUrl:g,originalArrayBuffer:e}),C.onerror=a,C.src=g}catch(s){a(s)}});return await this.transformImageFromArrayBuffer(n,i,n.originalImageSize!=null)}async getSvgImageSize(e){let n=new DOMParser().parseFromString(await e.text(),"image/svg+xml").querySelector("svg");if(!n)throw Error("Failed to parse SVG image");let o=n.getAttribute("width"),a=n.getAttribute("height");if(o&&a)return null;let s=n.getAttribute("viewBox")||n.getAttribute("viewbox");if(s){let g=s.split(" ");return{width:+g[2],height:+g[3]}}throw Error("Failed to load SVG image. SVG must have width + height or viewBox definition.")}async transformImageFromArrayBuffer(e,i,t=!1){let n=await this.autoRotateSupported,o=Ft(n?-1:e.originalArrayBuffer);if(!e.originalImage||!e.originalImage.complete)return Promise.reject(new Error("No image loaded"));let a={original:{objectUrl:e.originalObjectUrl,image:e.originalImage,size:e.originalImageSize??{width:e.originalImage.naturalWidth,height:e.originalImage.naturalHeight}},exifTransform:o};return this.transformLoadedImage(a,i,t)}async transformLoadedImage(e,i,t=!1){let n=(i.canvasRotation??0)+e.exifTransform.rotate,o=e.original.size;if(!t&&n===0&&!e.exifTransform.flip&&!i.containWithinAspectRatio)return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:M({},o)},transformed:{objectUrl:e.original.objectUrl,image:e.original.image,size:M({},o)},exifTransform:e.exifTransform};let a=this.getTransformedSize(o,e.exifTransform,i),s=document.createElement("canvas");s.width=a.width,s.height=a.height;let g=s.getContext("2d");g?.setTransform(e.exifTransform.flip?-1:1,0,0,1,s.width/2,s.height/2),g?.rotate(Math.PI*(n/2)),g?.drawImage(e.original.image,-o.width/2,-o.height/2);let C=await new Promise(w=>s.toBlob(w,"image/"+(i.format??"png")));if(!C)throw new Error("Failed to get Blob for transformed image.");let T=URL.createObjectURL(C),I=await this.loadImageFromObjectUrl(T);return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:M({},o)},transformed:{objectUrl:T,image:I,size:{width:I.width,height:I.height}},exifTransform:e.exifTransform}}loadImageFromObjectUrl(e){return new Promise((i,t)=>{let n=new Image;n.onload=()=>i(n),n.onerror=t,n.src=e})}getTransformedSize(e,i,t){let n=(t.canvasRotation??0)+i.rotate;if(t.containWithinAspectRatio)if(n%2){let o=e.width*(t.aspectRatio??1),a=e.height/(t.aspectRatio??1);return{width:Math.max(e.height,o),height:Math.max(e.width,a)}}else{let o=e.height*(t.aspectRatio??1),a=e.width/(t.aspectRatio??1);return{width:Math.max(e.width,o),height:Math.max(e.height,a)}}return n%2?{height:e.width,width:e.height}:{width:e.width,height:e.height}}};function Ut(r){switch(r){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";case"ArrowLeft":default:return"left"}}function Wt(r){switch(r){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";case"ArrowLeft":default:return"right"}}function Lt(r,e){switch(r){case"ArrowUp":return{clientX:0,clientY:e*-1};case"ArrowRight":return{clientX:e,clientY:0};case"ArrowDown":return{clientX:0,clientY:e};case"ArrowLeft":default:return{clientX:e*-1,clientY:0}}}var ct=(()=>{let e=class e{get alignImageStyle(){return this.state.options.alignImage}constructor(t){this.sanitizer=t,this.pinchStart$=new ze,this.cropService=new xe,this.loadImageService=new _e,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.moveTypes=v,this.state=new fe,this.safeImgDataUrl=L(void 0),this.safeTransformStyle=L(void 0),this.marginLeft="0px",this.imageVisible=!1,this.allowMoveImage=!1,this.checkImageType=!0,this.disabled=!1,this.hidden=!1,this.imageCropped=P(),this.startCropImage=P(),this.imageLoaded=P(),this.cropperReady=P(),this.loadImageFailed=P(),this.transformChange=P(),this.cropperChange=P(),this.reset()}ngOnInit(){this.state.stepSize=this.initialStepSize||this.state.stepSize}ngOnChanges(t){let n=this.state.cropper(),o=this.state.transform,a=this.state.options.backgroundColor;if(this.state.setOptionsFromChanges(t),this.onChangesInputImage(t),t.transform&&this.transform&&(this.state.transform=this.transform,this.setCssTransform()),!this.state.loadedImage?.transformed.image.complete||!this.state.maxSize)return;if(this.containWithinAspectRatio&&t.aspectRatio||t.containWithinAspectRatio||t.canvasRotation){this.loadImageService.transformLoadedImage(this.state.loadedImage,this.state.options).then(g=>this.setLoadedImage(g)).catch(g=>this.loadImageError(g));return}t.cropper&&this.cropper&&this.state.cropper.set(B(this.cropper,this.state,!0));let s=!this.state.equalsCropperPosition(n);s&&(!this.cropper||!this.state.equalsCropperPosition(this.cropper))&&this.cropperChange.emit(this.state.cropper()),(s||!this.state.equalsTransform(o)||this.state.options.backgroundColor!==a)&&this.doAutoCrop(),t.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesInputImage(t){(t.imageChangedEvent||t.imageURL||t.imageBase64||t.imageFile)&&this.reset(),t.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),t.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),t.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),t.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){let t=this.imageChangedEvent?.target?.files;return t instanceof FileList&&t.length>0}reset(){this.state.loadedImage=void 0,this.state.maxSize.set({width:0,height:0}),this.imageVisible=!1}loadImageFile(t){this.loadImageService.loadImageFile(t,this.state.options).then(n=>this.setLoadedImage(n)).catch(n=>this.loadImageError(n))}loadBase64Image(t){this.loadImageService.loadBase64Image(t,this.state.options).then(n=>this.setLoadedImage(n)).catch(n=>this.loadImageError(n))}loadImageFromURL(t){this.loadImageService.loadImageFromURL(t,this.state.options).then(n=>this.setLoadedImage(n)).catch(n=>this.loadImageError(n))}setLoadedImage(t){this.state.loadedImage=t,this.safeImgDataUrl.set(this.sanitizer.bypassSecurityTrustResourceUrl(t.transformed.objectUrl))}loadImageError(t){console.error(t),this.loadImageFailed.emit()}setCssTransform(){let t=this.state.transform?.translateUnit||"%";this.safeTransformStyle.set(this.sanitizer.bypassSecurityTrustStyle(`translate(${this.state.transform.translateH||0}${t}, ${this.state.transform.translateV||0}${t}) scaleX(`+(this.state.transform.scale||1)*(this.state.transform.flipH?-1:1)+") scaleY("+(this.state.transform.scale||1)*(this.state.transform.flipV?-1:1)+") rotate("+(this.state.transform.rotate||0)+"deg)"))}imageLoadedInView(){this.state.loadedImage!=null&&(this.imageLoaded.emit(this.state.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.cropper&&(!this.maintainAspectRatio||this.state.aspectRatioIsCorrect())?(this.state.cropper.set(B(this.cropper,this.state,!0)),this.emitCropperPositionChange(this.cropper)):(this.state.cropper.set(B(this.state.maxSizeCropperPosition(),this.state,!0)),this.cropperChange.emit(this.state.cropper())),this.imageVisible=!0,this.cropperReady.emit(this.state.maxSize()),this.doAutoCrop()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>1}onResize(){if(this.state.loadedImage)if(this.hidden)this.resizedWhileHidden=!0;else{let t=this.state.maxSize();this.setMaxSize(),this.state.resizeCropperPosition(t)}}keyboardAccess(t){this.changeKeyboardStepSize(t),this.keyboardMoveCropper(t)}changeKeyboardStepSize(t){let n=+t.key;n>=1&&n<=9&&(this.state.stepSize=n)}keyboardMoveCropper(t){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t.key))return;let o=t.shiftKey?v.Resize:v.Move,a=t.altKey?Wt(t.key):Ut(t.key),s=Lt(t.key,this.state.stepSize);t.preventDefault(),t.stopPropagation(),this.moveStart={type:o,position:a,clientX:0,clientY:0,transform:this.state.transform,cropper:this.state.cropper()},this.handleMouseMove(s),this.handleMouseUp()}startMove(t,n,o=null){this.disabled||this.moveStart&&this.moveStart.type===v.Pinch||n===v.Drag&&!this.allowMoveImage||("preventDefault"in t&&t.preventDefault(),this.moveStart={type:n,position:o,clientX:ie(t),clientY:ne(t),transform:this.state.transform,cropper:this.state.cropper()},this.initMouseMove())}initMouseMove(){pe(V(document,"mousemove"),V(document,"touchmove")).pipe(le(pe(V(document,"mouseup"),V(document,"touchend"),this.pinchStart$).pipe(Re()))).subscribe({next:t=>this.handleMouseMove(t),complete:()=>this.handleMouseUp()})}handleMouseMove(t){if(this.moveStart){if("stopPropagation"in t&&t.stopPropagation(),"preventDefault"in t&&t.preventDefault(),this.moveStart.type===v.Move)this.state.cropper.set(te(Pt(t,this.moveStart),this.state,!0));else if(this.moveStart.type===v.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.state.cropper.set(te(at(t,this.moveStart,this.state),this.state,!1));else if(this.moveStart.type===v.Drag){let n=ie(t)-this.moveStart.clientX,o=ne(t)-this.moveStart.clientY;this.state.transform=A(M({},this.state.transform),{translateH:(this.moveStart.transform?.translateH||0)+n,translateV:(this.moveStart.transform?.translateV||0)+o}),this.setCssTransform()}}}handleMouseUp(){!this.moveStart||this.moveStart.type===v.Pinch||((!this.state.equalsCropperPosition(this.moveStart.cropper)||this.moveStart.transform&&!this.state.equalsTransform(this.moveStart.transform))&&(this.moveStart.type===v.Drag?this.transformChange.emit(this.state.transform):this.cropperChange.emit(this.state.cropper()),this.doAutoCrop()),this.moveStart=void 0)}startPinch(t){if(this.disabled||!this.sourceImageLoaded()||t.touches.length<2)return;"preventDefault"in t&&t.preventDefault();let n=this.state.cropper();this.moveStart={type:v.Pinch,position:"center",clientX:n.x1+(n.x2-n.x1)/2,clientY:n.y1+(n.y2-n.y1)/2,cropper:n},this.initPinch()}initPinch(){this.pinchStart$.next(),V(document,"touchmove").pipe(le(V(document,"touchend"))).subscribe({next:t=>this.handlePinchMove(t),complete:()=>this.handlePinchStop()})}handlePinchMove(t){this.moveStart&&(t.preventDefault&&t.preventDefault(),this.moveStart.type===v.Pinch&&!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.state.cropper.set(te(at(t,this.moveStart,this.state),this.state,!1)))}handlePinchStop(){this.moveStart&&(this.state.equalsCropperPosition(this.moveStart.cropper)||(this.emitCropperPositionChange(this.moveStart.cropper),this.doAutoCrop()),this.moveStart=void 0)}setMaxSize(){if(this.sourceImage){let t=getComputedStyle(this.sourceImage.nativeElement);this.state.setMaxSize(parseFloat(t.width),parseFloat(t.height)),this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.state.maxSize().width/2+"px)")}}emitCropperPositionChange(t){this.state.equalsCropperPosition(t)||this.cropperChange.emit(this.state.cropper())}doAutoCrop(){this.state.options.autoCrop&&this.crop()}crop(t=this.state.options.output){if(this.state.loadedImage?.transformed?.image!=null){if(this.startCropImage.emit(),t==="blob")return this.cropToBlob();if(t==="base64")return this.cropToBase64()}return null}cropToBlob(){return new Promise(async(t,n)=>{let o=await this.cropService.crop(this.state.toCropInput(),"blob");o?(this.imageCropped.emit(o),t(o)):n("Crop image failed")})}cropToBase64(){let t=this.cropService.crop(this.state.toCropInput(),"base64");return t?(this.imageCropped.emit(t),t):null}resetCropperPosition(){this.state.cropper.set(B(this.state.maxSizeCropperPosition(),this.state,!0)),this.cropperChange.emit(this.state.cropper())}ngOnDestroy(){this.pinchStart$.complete()}};e.\u0275fac=function(n){return new(n||e)(S(De))},e.\u0275cmp=O({type:e,selectors:[["image-cropper"]],viewQuery:function(n,o){if(n&1&&(he(vt,7),he(It,5)),n&2){let a;ge(a=de())&&(o.wrapper=a.first),ge(a=de())&&(o.sourceImage=a.first)}},hostVars:6,hostBindings:function(n,o){n&1&&d("resize",function(){return o.onResize()},Ve),n&2&&(U("text-align",o.alignImageStyle),Y("disabled",o.disabled)("ngx-ic-hidden",o.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",options:"options",cropperFrameAriaLabel:"cropperFrameAriaLabel",output:"output",format:"format",autoCrop:"autoCrop",cropper:"cropper",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",checkImageType:"checkImageType",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange",cropperChange:"cropperChange"},features:[Ae],decls:4,vars:10,consts:[["sourceImage",""],[3,"touchstart"],["class","ngx-ic-source-image","role","presentation",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],["role","presentation",1,"ngx-ic-source-image",3,"load","mousedown","touchstart","error","src"],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],["role","presentation",1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-top",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left",3,"mousedown","touchstart"]],template:function(n,o){n&1&&(p(0,"div",1),d("touchstart",function(s){return o.startPinch(s)}),y(1,zt,2,8,"img",2),x(2,"div",3),y(3,St,3,16,"div",4),c()),n&2&&(U("background",o.imageVisible&&o.state.options.backgroundColor),u(),f("ngIf",o.safeImgDataUrl()),u(),U("width",o.state.maxSize().width||0,"px")("height",o.state.maxSize().height||0,"px")("margin-left",o.state.options.alignImage==="center"?o.marginLeft:null),u(),f("ngIf",o.imageVisible))},dependencies:[W],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{display:inline;max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:var(--cropper-color, #53535C);background:transparent;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:var(--cropper-border, 1px solid rgba(255, 255, 255, .5))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:hover   .ngx-ic-move[_ngcontent-%COMP%]{border:var(--cropper-hover-border, var(--cropper-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border:var(--cropper-focus-border, 2px solid dodgerblue)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{background:var(--cropper-resize-square-focus-bg, var(--cropper-resize-square-bg, #53535C));border:var(--cropper-resize-square-focus-border, var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;width:6px;height:6px;box-sizing:content-box;background:var(--cropper-resize-square-bg, #53535C);border:var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]:hover   .ngx-ic-square[_ngcontent-%COMP%]{background:var(--cropper-resize-square-hover-bg, var(--cropper-resize-square-bg, #53535C));border:var(--cropper-resize-square-hover-border, var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ic-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0});let r=e;return r})();function Bt(r,e){if(r&1&&(p(0,"div",12)(1,"p")(2,"strong"),_(3,"File Name:"),c(),_(4),c()()),r&2){let i=l();u(4),Q(" ",i.fileName)}}function Dt(r,e){if(r&1&&(p(0,"div",13),x(1,"img",14),c()),r&2){let i=l();u(),f("src",i.croppedImage,X)}}var oe=class r{imageChangedEvent="";croppedImage;fileName;base64String;byteString;blobImg;fileParameterImg;aspectRatio=1;ngOnInit(){}onSubmit(){this.croppedImage?(alert("Submit successful \u2014 now pass result via Output or DialogRef if needed"),console.log({croppedImage:this.croppedImage,fileParameterImg:this.fileParameterImg,base64String:this.base64String,blobImg:this.blobImg})):alert("Please choose image file")}fileChangeEvent(e){this.imageChangedEvent=e,this.fileName=e.target.files?.[0]?.name}imageCropped(e){this.croppedImage=e.base64??"";let i=e.base64?.split(",");if(!i||i.length<2)return;this.base64String=i[1],this.byteString=i[0].includes("base64")?atob(i[1]):unescape(i[1]);let t=i[0].split(":")[1].split(";")[0],n=new Uint8Array(this.byteString.length);for(let o=0;o<this.byteString.length;o++)n[o]=this.byteString.charCodeAt(o);this.blobImg=new Blob([n],{type:t}),this.fileParameterImg={data:this.blobImg,fileName:this.fileName}}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=O({type:r,selectors:[["app-upload-cropped-image"]],decls:17,vars:5,consts:[["fileCtrl",""],[1,"upload-container"],[1,"choose-btn",3,"click"],["class","filename-card",4,"ngIf"],["type","file","hidden","","accept","image/*",3,"change"],[1,"crop-wrapper"],[1,"crop-column"],["output","base64",3,"imageCropped","imageChangedEvent","maintainAspectRatio","aspectRatio"],["class","crop-column preview",4,"ngIf"],[1,"action-row"],[1,"cancel-btn",3,"click"],[1,"submit-btn",3,"click"],[1,"filename-card"],[1,"crop-column","preview"],[3,"src"]],template:function(i,t){if(i&1){let n=E();p(0,"div",1)(1,"h2"),_(2,"Upload Image"),c(),p(3,"button",2),d("click",function(){m(n);let a=Fe(7);return h(a.click())}),_(4,"\u{1F4C1} Choose File"),c(),y(5,Bt,5,1,"div",3),p(6,"input",4,0),d("change",function(a){return m(n),h(t.fileChangeEvent(a))}),c(),p(8,"div",5)(9,"div",6)(10,"image-cropper",7),d("imageCropped",function(a){return m(n),h(t.imageCropped(a))}),c()(),y(11,Dt,2,1,"div",8),c(),p(12,"div",9)(13,"button",10),d("click",function(){return m(n),h(t.croppedImage="")}),_(14,"Cancel"),c(),p(15,"button",11),d("click",function(){return m(n),h(t.onSubmit())}),_(16,"Submit"),c()()()}i&2&&(u(5),f("ngIf",t.fileName),u(5),f("imageChangedEvent",t.imageChangedEvent)("maintainAspectRatio",!0)("aspectRatio",t.aspectRatio),u(),f("ngIf",t.croppedImage))},dependencies:[G,W,K,ct],styles:[".upload-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:auto;border:1px solid #ddd;border-radius:8px;background-color:#fff}.upload-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:16px;font-size:1.5rem}.upload-container[_ngcontent-%COMP%]   .choose-btn[_ngcontent-%COMP%]{padding:8px 16px;background-color:#eee;border:1px solid #aaa;cursor:pointer;margin-bottom:10px}.upload-container[_ngcontent-%COMP%]   .filename-card[_ngcontent-%COMP%]{padding:10px 15px;border:1px solid lightgray;border-radius:4px;margin-bottom:16px}.upload-container[_ngcontent-%COMP%]   .crop-wrapper[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px}.upload-container[_ngcontent-%COMP%]   .crop-wrapper[_ngcontent-%COMP%]   .crop-column[_ngcontent-%COMP%]{flex:1 1 calc(50% - 10px)}.upload-container[_ngcontent-%COMP%]   .crop-wrapper[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;border:1px solid #ccc;border-radius:4px}.upload-container[_ngcontent-%COMP%]   .action-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}.upload-container[_ngcontent-%COMP%]   .action-row[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .upload-container[_ngcontent-%COMP%]   .action-row[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]{padding:8px 20px;border:none;cursor:pointer;font-weight:700}.upload-container[_ngcontent-%COMP%]   .action-row[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background-color:#f5f5f5}.upload-container[_ngcontent-%COMP%]   .action-row[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}"]})};var pt=[{path:"",redirectTo:"sign-in",pathMatch:"full"},{path:"sign-in",component:Z},{path:"admin",loadChildren:()=>import("./chunk-KDBPZWMA.js").then(r=>r.AdminRoutes)},{path:"error",component:it},{path:"loading",component:nt},{path:"upload-image",component:oe},{path:"warning",component:ot},{path:"**",redirectTo:"sign-in"}];var re=class r{constructor(e){this._authenticationService=e}intercept(e,i){let t=this._authenticationService.getToken();if(t){let n=e.clone({setHeaders:{Authorization:`Bearer ${t}`}});return i.handle(n)}return i.handle(e)}static \u0275fac=function(i){return new(i||r)(Oe(J))};static \u0275prov=Se({token:r,factory:r.\u0275fac})};var lt={providers:[Te(),Ee(),Xe(pt),Le(),Pe(Be),{provide:We,useClass:re,multi:!0}]};var ae=class r{title="Screw_Soft_CMS_Portal";static \u0275fac=function(i){return new(i||r)};static \u0275cmp=O({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(i,t){i&1&&x(0,"router-outlet")},dependencies:[qe],encapsulation:2})};Ue(ae,lt).catch(r=>console.error(r));
